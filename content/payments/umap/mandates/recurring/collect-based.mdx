---
sidebar_title: Collect Based
page_title: UMAP - Mandates - Collect Based Recurring Mandate
order: 1
visible_in_sidebar: true
---

## Collect Based Recurring Mandate

Steps to collect a payment via an collect based recurring mandate

<hr class="primary" />

#### Step 1 - create a collect based recurring mandate

The process for mandate creation is described in the below diagram:

<img
  src="https://storage.googleapis.com/strapi-assets/latest/collect-based-mandate-create/collect-based-mandate-create.png"
  alt="Bridge"
/>

The merchant will have to call the **<i>create mandate API</i>** with the correct set of parameters.

<table>
    <tbody>
        <tr>
            <th>Staging Host</th>
            <td>
                <code>https://umap-dev-core.setu.co/api/v1</code>
            </td>
        </tr>
        <tr>
            <th>Method</th>
            <td>
                <code>POST</code>
            </td>
        </tr>
        <tr>
            <th>Path</th>
            <td>
                <code>/merchants/mandates</code>
            </td>
        </tr>
        <tr>
            <th>Header</th>
            <td>
                <code>merchantId</code><br/>
                <code>Authorization</code>: Bearer &lt;<b>insert_token_here</b>&gt;.
                Generate this token using <a
                    href="/payments/upi-deeplinks/resources/oauth"
                    target="_blank">
                    OAuth
                </a> or <a
                    href="/payments/upi-deeplinks/resources/jwt"
                    target="_blank">
                    JWT
                </a>.<br />
                <br />
                <code>Content-Type</code>—will be <code>application/json</code>
            </td>
        </tr>
    </tbody>
</table>

###### Sample request

<CodeBlockWithCopy language="json">
    {`{
    "allowMultipleDebit": false,
    "amount": 1000,
    "amountRule": "max",
    "autoExecute": false,
    "autoPreNotify": false,
    "blockFunds": false,
    "creationMode": "qr",
    "currency": "INR",
    "customerRevocable": false,
    "customerVpa": "ram@axis",
    "endDate": "02012008",
    "expireAfter": 120,
    "firstExecutionAmount": 0,
    "frequency": "weekly",
    "initiationMode": "00",
    "maxAmountLimit": 1000,
    "merchantReferenceId": "ABC1234789",
    "merchantVpa": "acme.corp@axis",
    "productConfigId": "01ARZ3NDEKTSV4RRFFQ69G5FAV",
    "purpose": "14",
    "recurrenceRule": "on",
    "recurrenceValue": 1,
    "shareToPayee": false,
    "startDate": "02012006",
    "transactionNote": "Transaction note"
}`}
</CodeBlockWithCopy>

<Card padding="nano" shape="rounded">
    <details>
        <summary>
            <Text size="medium" marginBottom="none" paddingRight="medium">Possible values and descriptions of <code>frequency</code>, <code>recurrenceValue</code> and <code>recurrenceRule</code></Text>
        </summary>
        <table>
            <tbody>
                <tr>
                    <th>frequency</th>
                    <th>recurrenceValue</th>
                    <th>recurrenceRule</th>
                    <th>recurrence schedule</th>
                </tr>
                <tr>
                    <td>daily</td>
                    <td>0</td>
                    <td>on</td>
                    <td>daily</td>
                </tr>
                <tr>
                    <td>weekly</td>
                    <td>
                        1 - 7<br/>
                        {" "}<br/>
                        1 represents MONDAY<br/>
                        {" "}<br/>
                        7 represents SUNDAY
                    </td>
                    <td>on, before, after</td>
                    <td>
                        Suppose <code>recurrenceValue</code> is <code>x</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>on</code> then the mandate will be executed every week on the weekday represented by <code>x</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>before</code> then the mandate can be executed every week on any one weekday - from MONDAY to the weekday represented by <code>x</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>after</code> then the mandate can be executed every week on any one weekday - from the weekday represented by <code>x</code> to SUNDAY<br/>
                    </td>
                </tr>
                <tr>
                    <td>fortnightly</td>
                    <td>
                        1 - 16<br/>
                        {" "}<br/>
                        1 represents 1st in the first fortnight and 15th in the second fortnight of every month<br/>
                        {" "}<br/>
                        15 represents 15th in the first fortnight and 30th (or last day of month for February) in the second fortnight of every month<br/>
                        {" "}<br/>
                        16 represents 15th in the first fortnight and last day in the second fortnight of every month<br/>
                    </td>
                    <td>on, before, after</td>
                    <td>
                        Suppose that as per the <code>recurrenceValue</code> the first fortnight execution day of month is <code>x</code> and the second fortnight execution day of month is <code>y</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>on</code> then the mandate will be executed every month on the day of month represented by <code>x</code> and <code>y</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>before</code> then the mandate can be executed every month on any one day of month - from 1st to <code>x</code> and on any one day of the month - from 16th to <code>y</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>after</code> then the mandate can be executed every month on any one day of month - from <code>x</code> to 15th of the month and on any one day of the month - from <code>y</code> to the last day of the month<br/>
                    </td>
                </tr>
                <tr>
                    <td>monthly</td>
                    <td>
                        1 - 31<br/>
                        {" "}<br/>
                        1 represents 1st of the month<br/>
                        {" "}<br/>
                        31 represents 31st of the month<br/>
                    </td>
                    <td>on, before, after</td>
                    <td>
                        Suppose <code>recurrenceValue</code> is <code>x</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>on</code> then the mandate will be executed every month on the day of month represented by <code>x</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>before</code> then the mandate can be executed every month on any one day of month - from 1st to <code>x</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>after</code> then the mandate can be executed every month on any one day of month - from <code>x</code> to the last day of the month<br/>
                    </td>
                </tr>
                <tr>
                    <td>bi monthly</td>
                    <td>
                        1 - 31<br/>
                        {" "}<br/>
                        1 represents 1st of the month<br/>
                        {" "}<br/>
                        31 represents 31st of the month<br/>
                    </td>
                    <td>on, before, after</td>
                    <td>
                        Suppose <code>recurrenceValue</code> is <code>x</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>on</code> then the mandate will be executed every 2nd month on the day of month represented by <code>x</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>before</code> then the mandate can be executed every 2nd month on any one day of month - from 1st to <code>x</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>after</code> then the mandate can be executed every 2nd month on any one day of month - from <code>x</code> to the last day of the month<br/>
                    </td>
                </tr>
                <tr>
                    <td>quarterly</td>
                    <td>
                        1 - 31<br/>
                        {" "}<br/>
                        1 represents 1st of the month<br/>
                        {" "}<br/>
                        31 represents 31st of the month<br/>
                    </td>
                    <td>on, before, after</td>
                    <td>
                        Suppose <code>recurrenceValue</code> is <code>x</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>on</code> then the mandate will be executed every 3rd month on the day of month represented by <code>x</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>before</code> then the mandate can be executed every 3rd month on any one day of month - from 1st to <code>x</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>after</code> then the mandate can be executed every 3rd month on any one day of month - from <code>x</code> to the last day of the month<br/>
                    </td>
                </tr>
                <tr>
                    <td>half yearly</td>
                    <td>
                        1 - 31<br/>
                        {" "}<br/>
                        1 represents 1st of the month<br/>
                        {" "}<br/>
                        31 represents 31st of the month<br/>
                    </td>
                    <td>on, before, after</td>
                    <td>
                        Suppose <code>recurrenceValue</code> is <code>x</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>on</code> then the mandate will be executed every 6th month on the day of month represented by <code>x</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>before</code> then the mandate can be executed every 6th month on any one day of month - from 1st to <code>x</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>after</code> then the mandate can be executed every 6th month on any one day of month - from <code>x</code> to the last day of the month<br/>
                    </td>
                </tr>
                <tr>
                    <td>half yearly</td>
                    <td>
                        1 - 31<br/>
                        {" "}<br/>
                        1 represents 1st of the month<br/>
                        {" "}<br/>
                        31 represents 31st of the month<br/>
                    </td>
                    <td>on, before, after</td>
                    <td>
                        Suppose <code>recurrenceValue</code> is <code>x</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>on</code> then the mandate will be executed every year on the day of month represented by <code>x</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>before</code> then the mandate can be executed every year on any one day of month - from 1st to <code>x</code><br/>
                        {" "}<br/>
                        If <code>recurrenceRule</code> is <code>after</code> then the mandate can be executed every year month on any one day of month - from <code>x</code> to the last day of the month<br/>
                    </td>
                </tr>
            </tbody>
        </table>
    </details>
</Card>

<Callout type="warning">
    <ul>
        <li>The value of <code>creationMode</code> must be <code>collect</code> for creating a collect based mandate.</li>
        <li>The value of <code>initiationMode</code> must be <code>00</code> if <code>creationMode</code> is <code>collect</code></li>
    </ul>
</Callout>

<Callout type="note">
    <ul>
        <li>If the value of <code>autoExecute</code> and <code>autoPreNotify</code> is <code>false</code> then the merchant is responsible for triggering the pre debit notification and execution in every recurrence cycle.</li>
        <li>If the value of <code>autoExecute</code> and <code>autoPreNotify</code> is <code>true</code> then no merchant intervention is needed and UMAP is responsible for triggering the pre debit notification and execution in every recurrence cycle.</li>
    </ul>
</Callout>

###### Sample response

<CodeBlockWithCopy language="json">
    {`{
  "allowMultipleDebit": false,
  "amount": 1000,
  "amountRule": "max",
  "autoExecute": false,
  "autoPreNotify": false,
  "blockFunds": false,
  "createdAt": "2023-09-04 12:08:20.202644 +0530 IST",
  "creationMode": "collect",
  "currency": "INR",
  "customerRevocable": true,
  "customerVpa": "ram@axis",
  "endDate": "02012008",
  "expireAfter": 120,
  "firstExecutionAmount": 0,
  "frequency": "weekly",
  "id": "01ARZ3NDEKTSV4RRFFQ69G5FAV",
  "initiationMode": "00",
  "maxAmountLimit": 1000,
  "merchantId": "01ARZ3NDEKTSV4RRFFQ69G5FAV",
  "merchantReferenceId": "ABC1234789",
  "merchantVpa": "acme.corp@axis",
  "productConfigId": "01ARZ3NDEKTSV4RRFFQ69G5FAV",
  "purpose": "14",
  "recurrenceRule": "on",
  "recurrenceValue": 1,
  "shareToPayee": false,
  "startDate": "02012006",
  "status": "initiated",
  "transactionNote": "Transaction note",
  "txnId": "BTTZrc5gDFkuCr3n3I0ey4aNtzLOLR7K7aR"
}`}
</CodeBlockWithCopy>

**In the above response:**

-   `id` is a unique mandate ID that is associated with this mandate and can be used to track it later.

This request to trigger mandate creation via collect flow is flexible and allows for many use cases. To know more about all the API params, please refer to the API documentation <a href="/payments/umap/api-reference#/category~mandates/operation~mandates#create" target="_blank">here</a>.

Post this, once the customer clicks on the mandate creation notification and enters the mPIN, the merchant will receive a webhook for **<i>mandate registration confirmation</i>** 

Please refer to the Document Reference section for checking the API reference and the notifications.

<hr class="tertiary" />

#### Step 2 - send a pre debit notification

Once the mandate is **LIVE** the merchant needs to send a pre debit notification 48 - 72 Hrs before debit / execution to let the customer be notified of the upcoming debit.

<Callout type="tip">
    Merchant intervention is only needed for a pre debit notification if <code>autoExecute</code> and <code>autoPreNotify</code> are set to <code>false</code> while creating a mandate 
</Callout>

The process for mandate pre debit notification is described in the below diagram:

<img
  src="https://storage.googleapis.com/strapi-assets/latest/mandate-pre-debit-notification/mandate-pre-debit-notification.png"
  alt="Bridge"
/>

The merchant will have to call the **<i>send mandate pre debit notification API</i>** with the correct set of parameters.

<table>
    <tbody>
        <tr>
            <th>Staging Host</th>
            <td>
                <code>https://umap-dev-core.setu.co/api/v1</code>
            </td>
        </tr>
        <tr>
            <th>Method</th>
            <td>
                <code>POST</code>
            </td>
        </tr>
        <tr>
            <th>Path</th>
            <td>
                <code>/merchants/mandates&#123;mandateId&#125;notify</code>
            </td>
        </tr>
        <tr>
            <th>Header</th>
            <td>
                <code>merchantId</code><br/>
                <code>Authorization</code>: Bearer &lt;<b>insert_token_here</b>&gt;.
                Generate this token using <a
                    href="/payments/upi-deeplinks/resources/oauth"
                    target="_blank">
                    OAuth
                </a> or <a
                    href="/payments/upi-deeplinks/resources/jwt"
                    target="_blank">
                    JWT
                </a>.<br />
                <br />
                <code>Content-Type</code>—will be <code>application/json</code>
            </td>
        </tr>
    </tbody>
</table>

###### Sample request

<CodeBlockWithCopy language="json">
    {`{
    "amount": 1000,
    "executionDate": "04012006",
    "merchantReferenceId": "ABC1234789",
    "sequenceNumber": 1,
    "umn": "setumandate1234789@ybl"
}`}
</CodeBlockWithCopy>

<Callout type="warning">
    <ul>
        <li>The value of <code>amount</code> must be as per the <code>amountRule</code> and <code>maxAmountLimit</code> configured while creating the mandate.</li>
        <li>The value of <code>executionDate</code> must be <code>24 - 48 Hrs</code> ahead of current time for <code>daily mandates</code>.</li>
        <li>The value of <code>executionDate</code> must be <code>48 - 72 Hrs</code> ahead of current time for recurring mandates other than <code>daily mandates</code>.</li>
    </ul>
</Callout>

<Callout type="note">
    The value of <code>umn</code> can be derived from the notifications received by the merchant during mandate creation flow or via check mandate status API
</Callout>

###### Sample response

<CodeBlockWithCopy language="json">
    {`{
  "amount": 1000,
  "createdAt": "2023-09-04 12:08:20.202644 +0530 IST",
  "executionDate": "04012006",
  "id": "01ARZ3NDEKTSV4RRFFQ69G5FAV",
  "mandateId": "01ARZ3NDEKTSV4RRFFQ69G5FAV",
  "merchantId": "01ARZ3NDEKTSV4RRFFQ69G5FAV",
  "merchantReferenceId": "ABC1234789",
  "sequenceNumber": 1,
  "status": "pending",
  "txnId": "BTTZrc5gDFkuCr3n3I0ey4aNtzLOLR7K7aR",
  "umn": "c27f5fc30d344e9594fce0afa34f8859@mypsp"
}`}
</CodeBlockWithCopy>

**In the above response:**

-   `id` is a unique ID that is associated with this mandate pre debit notification and can be used to track it later.

To know more about all the API params, please refer to the API documentation <a href="/payments/umap/api-reference#/category~mandates/operation~mandates#notify" target="_blank">here</a>.

UMAP will send notifications to the merchant once **<i>the pre-debit notification operation is completed</i>** and **<i>the final status of the mandate.</i>**

<Callout type="highlight">
    If <code>autoExecute</code> and <code>autoPreNotify</code> are set to <code>true</code> while creating a mandate, UMAP will schedule pre debit notifications and send notifications to the merchant for <code>pre debit notification confirmation</code> and <code>mandate status</code> in every recurrence cycle
</Callout>

Please refer to the Document Reference section for checking the API reference and the notifications.

<hr class="tertiary" />

#### Step 3 - execute mandate

<Callout type="tip">
    Merchant intervention is only needed for an execution if <code>autoExecute</code> and <code>autoPreNotify</code> are set to <code>false</code> while creating a mandate 
</Callout>

Once the mandate pre debit notification is **successful**, the merchant can execute the mandate on the `executionDate` mentioned while sending the pre debit notification.

The process for mandate execution is described in the below diagram:

<img
  src="https://storage.googleapis.com/strapi-assets/latest/mandate-pre-debit-notification/mandate-pre-debit-notification.png"
  alt="Bridge"
/>

The merchant will have to call the **<i>execute mandate API</i>** with the correct set of parameters.

<table>
    <tbody>
        <tr>
            <th>Staging Host</th>
            <td>
                <code>https://umap-dev-core.setu.co/api/v1</code>
            </td>
        </tr>
        <tr>
            <th>Method</th>
            <td>
                <code>POST</code>
            </td>
        </tr>
        <tr>
            <th>Path</th>
            <td>
                <code>/merchants/mandates&#123;mandateId&#125;execute</code>
            </td>
        </tr>
        <tr>
            <th>Header</th>
            <td>
                <code>merchantId</code><br/>
                <code>Authorization</code>: Bearer &lt;<b>insert_token_here</b>&gt;.
                Generate this token using <a
                    href="/payments/upi-deeplinks/resources/oauth"
                    target="_blank">
                    OAuth
                </a> or <a
                    href="/payments/upi-deeplinks/resources/jwt"
                    target="_blank">
                    JWT
                </a>.<br />
                <br />
                <code>Content-Type</code>—will be <code>application/json</code>
            </td>
        </tr>
    </tbody>
</table>

###### Sample request

<CodeBlockWithCopy language="json">
    {`{
    "amount": 1000,
    "merchantReferenceId": "ABC1234789",
    "remark": "Transaction for car loan emi",
    "sequenceNumber": 1,
    "umn": "setumandate1234789@ybl"
}`}
</CodeBlockWithCopy>

<Callout type="warning">
    Note that the value of <code>amount</code> must be equal to the <code>amount</code> mentioned while sending mandate pre debit notification.
</Callout>

<Callout type="note">
    The value of <code>umn</code> can be derived from the notifications received by the merchant during mandate creation flow or via check mandate status API
</Callout>

###### Sample response

<CodeBlockWithCopy language="json">
    {`{
  "amount": 1000,
  "createdAt": "2023-09-04 12:08:20.202644 +0530 IST",
  "id": "01ARZ3NDEKTSV4RRFFQ69G5FAV",
  "mandateId": "01ARZ3NDEKTSV4RRFFQ69G5FAV",
  "merchantId": "01ARZ3NDEKTSV4RRFFQ69G5FAV",
  "merchantReferenceId": "ABC1234789",
  "remark": "Transaction for car loan emi",
  "sequenceNumber": 1,
  "status": "pending",
  "txnId": "BTTZrc5gDFkuCr3n3I0ey4aNtzLOLR7K7aR",
  "umn": "c27f5fc30d344e9594fce0afa34f8859@mypsp"
}`}
</CodeBlockWithCopy>

**In the above response:**

-   `id` is a unique ID that is associated with this mandate execution and can be used to track it later.

To know more about all the API params, please refer to the API documentation <a href="/payments/umap/api-reference#/category~mandates/operation~mandates#execute" target="_blank">here</a>.

UMAP will send notifications to the merchant once **<i>the execution operation is completed</i>** and **<i>the final status of the mandate.</i>**

<Callout type="highlight">
    If <code>autoExecute</code> and <code>autoPreNotify</code> are set to <code>true</code> while creating a mandate, UMAP will schedule executions and send notifications to the merchant for <code>execution confirmation</code> and <code>mandate status</code> in every recurrence cycle
</Callout>

Please refer to the Document Reference section for checking the API reference and the notifications.

<hr class="primary" />

Other operations that can be performed on a recurring mandate once it is <b>LIVE</b>
<ul>
    <li>Updating a recurring mandate</li>
    <li>Revoking a recurring mandate</li>
    <li>Pausing a recurring mandate</li>
    <li>Unpausing a paused recurring mandate</li>
</ul>

<hr class="tertiary" />

<NextPage
    info={{
        description: "Other operations that can be performed on a mandate.  ",
        slug: "/payments/umap/mandates/generic",
        title: "Generic Operations",
    }}
/>