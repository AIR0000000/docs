---
sidebar_title: Best Practices
page_title: BBPS COU â€” API integration
order: 1
visible_in_sidebar: true
---

## Polling interval (or Getting to know the status of the transaction????)

We recommend using webhooks instead of polling the `/response` API. For the first 3 minutes right after initiation of the transaction, looking out for the webhook notifications is recommended.

Ideally a transaction has a duration of 180 seconds for completion so the status will be notified via webhooks within 180 seconds. Even for pending transactions, the response will be posted via webhook as soon as the status changes. Post that polling `/response` API once in 15 mins can be tried. But we strongly recommended looking out for the webhook notifications.


### Polling multiple transactions

If the status of multiple pending transactions is to be known, instead of hitting `/response` API for each transaction, hitting `/transactions` API with the ID and checking your database of the change in status and then hitting `/response` API is also preferred.


## Retrying a failed Payment by reusing Fetch.

We have the ability to retry the Payment Request by reusing the Fetch Request only if the Payment Request for the same has failed due to `BBPS` error. The next Payment Request reusing this fetch request can be made within the next **48 hours** of the first Payment Request Failure.

Currently we don't allow retrying payment requests that fail due to error types `FUND_TRANSFER` or `APP`.

### Fetch Reusability

#### Normal Fetch-Pay Cycle

#### Steps
1. Initiate Bill Fetch Request and get reference ID `A`.
2. Get Bill Fetch Response using reference ID `A`.
3. Initiate Bill Payment Request using reference ID `A`.
4. Get Bill Payment Response using reference ID `A`.

| Entity              | Request                      | Response                                          |
|---------------------+------------------------------+---------------------------------------------------|
| BillFetchRequest    | {"billParameters": {}}       | {"refId": "A"}                                    |
| BillFetchResponse   | {"refId": "A"}               | {"billData": {}}                                  |
| BillPaymentRequest  | {"refId": "A", "payment":{}} | {"refId": "A"}                                    |
| BillPaymentResponse | {"refId": "A"}               | {"transactionId":{}, "status": "Success/Failure"} |



#### Fetch Reusability Cycle

#### Steps
1. Initiate Bill Fetch Request and get reference ID `A`.
2. Get Bill Fetch Response using reference ID `A`.
3. Initiate Bill Payment Request using reference ID `A`.
4. Get Bill Payment Response using reference ID `A`.
5. Initiate a new Bill Payment Request using reference ID `A` and receive reference ID `B`.
6. Get Bill Payment Response using reference ID `B`.

| Entity              | Request                      | Response                                                                    |
|---------------------+------------------------------+-----------------------------------------------------------------------------|
| BillFetchRequest    | {"billParameters": {}}       | {"refId": "A"}                                                              |
| BillFetchResponse   | {"refId": "A"}               | {"billData": {}}                                                            |
| BillPaymentRequest  | {"refId": "A", "payment":{}} | {"refId": "A"}                                                              |
| BillPaymentResponse | {"refId": "A"}               | {"refId": A", "transactionId":{}, "status": "Failure", "errorType": "BBPS"} |
| BillPaymentRequest  | {"refId": "A", "payment":{}} | {"refId": "B"}                                                              |
| BillPaymentResponse | {"refId": "B"}               | {"refId": "B", "transactionId":{}, "status": "Success"}                     |


#### Example

<details>
  <summary>Fetch Request #1</summary>
  ### Request
  ```js
{
    "agent": {
        "channel": "INT",
        "id": "AS01AS02INB519046223",
        "ip": "124.170.23.24",
        "mac": "48-4D-7E-CB-DB-6F"
    },
    "customer": {
        "mobile": "9999999081",
        "billParameters": [
            {
                "name": "a",
                "value": "10"
            },
            {
                "name": "a b",
                "value": "20"
            },
            {
                "name": "a b c",
                "value": "30"
            },
            {
                "name": "a b c d",
                "value": "40"
            },
            {
                "name": "a b c d e",
                "value": "50"
            }
        ]
    },
    "biller": {
        "id": "OTOE00005XXZ43"
    }
}
  ```

### Response

```js
{
    "data": {
        "refId": "CE9U2F9RHQPJICM8SC0G87SZTUR23440700"
    },
    "success": true,
    "traceId": "CE9U2F9RHQPJICM8SC00"
}
```
</details>


<details>
  <summary>Fetch Response #1</summary>
  ### Request
  ```js
{
    "refId": "CE9U2F9RHQPJICM8SC0G87SZTUR23440700"
}
  ```

### Response

```js
{
    "data": {
        "additionalInfo": [
            {
                "name": "a",
                "value": "10"
            },
            {
                "name": "a b",
                "value": "20"
            },
            {
                "name": "a b c",
                "value": "30"
            },
            {
                "name": "a b c d",
                "value": "40"
            }
        ],
        "bill": {
            "amount": 100000,
            "billDate": "2015-06-14",
            "billNumber": "12303",
            "billPeriod": "june",
            "customerName": "BBPS",
            "dueDate": "2015-06-20"
        },
        "billerRefId": "12345676",
        "exactness": "Exact",
        "paymentLimits": [
            {
                "maxLimit": 100000000,
                "minLimit": 1,
                "paymentMode": "Internet Banking",
                "supportsPendingStatus": false
            },
        ],
        "refId": "CE9U2F9RHQPJICM8SC0G87SZTUR23440700",
        "status": "Success"
    },
    "success": true,
    "traceId": "CE9U2H9RHQPJICM8SC20"
}
```
</details>

<details>
  <summary>Payment Request #1</summary>
  ### Request
  ```js
{
    "refId": "CE9U2F9RHQPJICM8SC0G87SZTUR23440700",
    "paymentDetails": {
        "mode": "Credit Card",
        "paymentRefId": "N2001121212344",
        "amount": 100,
        "timestamp": "2020-12-12T13:12:00+05:30"
    }
}
  ```

### Response

```js
{
    "data": {
        "refId": "CE9U2F9RHQPJICM8SC0G87SZTUR23440700"
    },
    "success": true,
    "traceId": "CE9U36PRHQPJICM8SC90"
}
```
</details>

<details>
  <summary>Payment Response #1</summary>
  ### Request
  ```js
{
    "refId": "CE9U2F9RHQPJICM8SC0G87SZTUR23440700"
}
  ```

### Response

```js
{
    "data": {
        "failureReason": {
            "code": "BOU002",
            "message": "TMM001",
            "type": "BBPS"
        },
        "refId": "CE9U2F9RHQPJICM8SC0G87SZTUR23440700",
        "refundDetails": {
            "status": "Success",
            "transactionId": "REFAS012344070238CZWXPJ"
        },
        "status": "Failure",
        "transactionId": "AS012344070238CZWXPJ"
    },
    "success": true,
    "traceId": "CE9U461RHQPJICM8SCGG"
}
```

- Payment was failure due to error type "BBPS".
- Fetch can be reused in the next 48 hours from the Payment Failure timestamp.
</details>

<details>
  <summary>Payment Request #2</summary>
  ### Request
  ```js
{
    "refId": "CE9U2F9RHQPJICM8SC0G87SZTUR23440700",
    "paymentDetails": {
        "mode": "Credit Card",
        "paymentRefId": "N2001121212344",
        "amount": 100000,
        "timestamp": "2020-12-12T13:12:00+05:30"
    }
}
  ```

### Response

```js
{
    "data": {
        "refId": "CE9U4I9RHQPJICM8SCK0303EZUD23440705"
    },
    "success": true,
    "traceId": "CE9U4E9RHQPJICM8SCIG"
}
```

- Provided refId in the Payment Request is the one linked to the Bill fetch (for which the Bill payment was a failure with "BBPS" error).
- A different refID is returned in Payment Response.

</details>

<details>
  <summary>Payment Response #2</summary>
  ### Request
  ```js
{
    "refId": "CE9U4I9RHQPJICM8SCK0303EZUD23440705"
}
  ```

### Response

```js
{
    "data": {
        "billerId": "OTOE00005XXZ43",
        "billerRefId": "12345037",
        "paymentDetails": {
            "amount": 100000,
            "mode": "Credit Card",
            "paymentRefId": "N2001121212344",
            "timestamp": "2020-12-12T13:12:00.000+05:30"
        },
        "refId": "CE9U4I9RHQPJICM8SCK0303EZUD23440705",
        "status": "Success",
        "transactionId": "AS0123440705054WJCMM"
    },
    "success": true,
    "traceId": "CE9U4OHRHQPJICM8SCNG"
}
```
- Using the new refId, we can find the status of the second transaction.

</details>
